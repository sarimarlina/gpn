<!-- Dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f4f6f9; }
        .sidebar { width: 250px; background: #343a40; color: white; height: 100vh; position: fixed; padding: 20px; }
        .content { margin-left: 260px; padding: 20px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h4>Selamat Datang Worker</h4>
        <ul class="nav flex-column">
            <li class="nav-item"><a href="Worker_dashboard.html" class="nav-link text-white">Biodata Worker</a></li>
            <li class="nav-item"><a href="grafik_absensi_worker.html" class="nav-link text-white">Grafik Absensi</a></li>
            <li class="nav-item"><a href="inputan_worker.html" class="nav-link text-white">Inputan Worker</a></li>
            <li class="nav-item"><a href="index.html" class="nav-link text-white">Keluar</a></li>
            
        </ul>
    </div>
    <div class="content">
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Input PTI Worker</title>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <style>
                .preview-img {
                    max-width: 100px;
                    max-height: 100px;
                    margin-top: 10px;
                    display: none;
                    border: 1px solid #ddd;
                    padding: 5px;
                }
            </style>
        </head>
        <body>
            <div class="container mt-5">
                <h2>Input PTI Worker</h2>
                <form id="ptiForm">
                    <div class="mb-3">
                        <label class="form-label">Nama</label>
                        <input type="text" class="form-control" id="nama" value="John Doe" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Badge</label>
                        <input type="text" class="form-control" id="badge" value="12345" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Tanggal</label>
                        <input type="date" class="form-control" id="tanggal" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Waktu</label>
                        <input type="time" class="form-control" id="waktu" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Alamat Login</label>
                        <input type="text" class="form-control" id="alamat" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">PTI (Upload Gambar)</label>
                        <input type="file" class="form-control image-input" id="pti" accept="image/*">
                        <img id="pti-preview" class="preview-img">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">DCU (Upload Gambar)</label>
                        <input type="file" class="form-control image-input" id="dcu" accept="image/*">
                        <img id="dcu-preview" class="preview-img">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Kerusakan Unit (Upload Gambar)</label>
                        <input type="file" class="form-control image-input" id="kerusakan" accept="image/*">
                        <img id="kerusakan-preview" class="preview-img">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Keterangan</label>
                        <select class="form-control" id="keterangan">
                            <option value="Aman">Aman</option>
                            <option value="Tidak Aman">Tidak Aman</option>
                        </select>
                    </div>
                    <div class="mb-3" id="penjelasanContainer" style="display: none;">
                        <label class="form-label">Penjelasan</label>
                        <textarea class="form-control" id="penjelasan" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Kirim</button>
                </form>
        
                <hr>
        
                <h3>Data Terkirim</h3>
                <table class="table mt-4">
                    <thead>
                        <tr>
                            <th>Nama</th>
                            <th>Badge</th>
                            <th>Tanggal</th>
                            <th>Waktu</th>
                            <th>Alamat Login</th>
                            <th>PTI</th>
                            <th>DCU</th>
                            <th>Kerusakan Unit</th>
                            <th>Keterangan</th>
                        </tr>
                    </thead>
                    <tbody id="ptiTableBody">
                        <!-- Data akan muncul di sini -->
                    </tbody>
                </table>
            </div>
        
            <script>
                $(document).ready(function () {
                    // Mengisi otomatis tanggal dan waktu saat ini
                    let now = new Date();
                    let formattedDate = now.toISOString().split("T")[0];
                    let formattedTime = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
                    $("#tanggal").val(formattedDate);
                    $("#waktu").val(formattedTime);
        
                    // Mengisi alamat login otomatis (contoh: dari IP)
                    $.getJSON("https://ipinfo.io", function (data) {
                        $("#alamat").val(data.city + ", " + data.country);
                    });
        
                    // Menampilkan kotak penjelasan jika "Tidak Aman" dipilih
                    $("#keterangan").change(function () {
                        if ($(this).val() === "Tidak Aman") {
                            $("#penjelasanContainer").show();
                        } else {
                            $("#penjelasanContainer").hide();
                            $("#penjelasan").val(""); // Reset nilai penjelasan
                        }
                    });
        
                    // Fungsi preview gambar
                    $(".image-input").change(function () {
                        let input = this;
                        let previewId = "#" + input.id + "-preview";
                        if (input.files && input.files[0]) {
                            let reader = new FileReader();
                            reader.onload = function (e) {
                                $(previewId).attr("src", e.target.result).show();
                            };
                            reader.readAsDataURL(input.files[0]);
                        }
                    });
        
                    $("#ptiForm").submit(function (event) {
                        event.preventDefault();
        
                        let nama = $("#nama").val();
                        let badge = $("#badge").val();
                        let tanggal = $("#tanggal").val();
                        let waktu = $("#waktu").val();
                        let alamat = $("#alamat").val();
                        let pti = $("#pti-preview").attr("src") || "";
                        let dcu = $("#dcu-preview").attr("src") || "";
                        let kerusakan = $("#kerusakan-preview").attr("src") || "";
                        let keterangan = $("#keterangan").val();
                        let penjelasan = $("#penjelasan").val();
        
                        // Menambahkan penjelasan jika "Tidak Aman"
                        let keteranganTeks = (keterangan === "Tidak Aman" && penjelasan) ? `${keterangan} - ${penjelasan}` : keterangan;
        
                        let newRow = `<tr>
                            <td>${nama}</td>
                            <td>${badge}</td>
                            <td>${tanggal}</td>
                            <td>${waktu}</td>
                            <td>${alamat}</td>
                            <td><img src="${pti}" width="50"></td>
                            <td><img src="${dcu}" width="50"></td>
                            <td><img src="${kerusakan}" width="50"></td>
                            <td>${keteranganTeks}</td>
                        </tr>`;
        
                        $("#ptiTableBody").append(newRow);
                        $("#ptiForm")[0].reset();
                        $(".preview-img").hide(); // Sembunyikan preview setelah submit
                        $("#tanggal").val(formattedDate);
                        $("#waktu").val(formattedTime);
                        $("#penjelasanContainer").hide();
                    });
                });
            </script>
        </body>
        </html>
        